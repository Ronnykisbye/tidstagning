/* ======================================================
   AFSNIT 01 – SPROG-DATA (I18N)
====================================================== */

const translations = {
    da: {
        app_title: "GreenTime Pro",

        // Knapper
        btn_start: "Start",
        btn_stop: "Stop",

        // Kolonneoverskrifter
        col_address: "Adresse",
        col_email: "Email",
        col_log_duration: "Varighed",
        col_log_time: "Tidspunkt",
        col_name: "Navn",
        col_phone: "Telefon",
        col_role: "Rolle",

        // Kunder
        customers_list: "Oversigt over kunder",
        customers_new: "Ny kunde",
        customers_save: "Gem kunde",
        customers_sub: "Opret og vedligehold din kundeliste.",
        customers_title: "Kunder",

        // Medarbejdere
        employees_list: "Liste over medarbejdere",
        employees_new: "Ny medarbejder",
        employees_save: "Gem medarbejder",
        employees_sub: "Hold styr på medarbejdere og roller.",
        employees_title: "Medarbejdere",

        // Menu
        menu_customers: "Kunder",
        menu_dashboard: "Tidsregistrering",
        menu_employees: "Medarbejdere",
        menu_logs: "Logs",
        menu_reports: "Rapporter",
        menu_settings: "Indstillinger",

        // Side-overskrifter + undertekster
        page_dashboard_sub: "Start og stop tid for opgaver – hurtigt overblik.",
        page_dashboard_title: "Tidsregistrering",

        page_logs_sub: "Historik over registreret arbejdstid.",
        page_logs_title: "Logs",

        page_reports_sub: "Overblik over registreret tid.",
        page_reports_title: "Rapporter",

        page_settings_sub: "Konfiguration af appen.",
        page_settings_title: "Indstillinger",

        // Placeholder-tekster
        reports_placeholder: "Rapportmodulet kommer senere.",
        settings_placeholder: "Her kan du senere justere avancerede indstillinger.",

        // Roller
        role_admin: "Admin",
        role_employee: "Medarbejder"
    },

    en: {
        app_title: "GreenTime Pro",

        btn_start: "Start",
        btn_stop: "Stop",

        col_address: "Address",
        col_email: "Email",
        col_log_duration: "Duration",
        col_log_time: "Time",
        col_name: "Name",
        col_phone: "Phone",
        col_role: "Role",

        customers_list: "Customer overview",
        customers_new: "New customer",
        customers_save: "Save customer",
        customers_sub: "Create and maintain your customer list.",
        customers_title: "Customers",

        employees_list: "Employee list",
        employees_new: "New employee",
        employees_save: "Save employee",
        employees_sub: "Keep track of employees and roles.",
        employees_title: "Employees",

        menu_customers: "Customers",
        menu_dashboard: "Time tracking",
        menu_employees: "Employees",
        menu_logs: "Logs",
        menu_reports: "Reports",
        menu_settings: "Settings",

        page_dashboard_sub: "Start and stop time for tasks – quick overview.",
        page_dashboard_title: "Time tracking",

        page_logs_sub: "History of recorded work time.",
        page_logs_title: "Logs",

        page_reports_sub: "Overview of recorded time.",
        page_reports_title: "Reports",

        page_settings_sub: "Configuration of the app.",
        page_settings_title: "Settings",

        reports_placeholder: "The reporting module will be added later.",
        settings_placeholder: "Later you can adjust advanced settings here.",

        role_admin: "Admin",
        role_employee: "Employee"
    },

    de: {
        app_title: "GreenTime Pro",

        btn_start: "Start",
        btn_stop: "Stopp",

        col_address: "Adresse",
        col_email: "E-Mail",
        col_log_duration: "Dauer",
        col_log_time: "Zeitpunkt",
        col_name: "Name",
        col_phone: "Telefon",
        col_role: "Rolle",

        customers_list: "Kundenübersicht",
        customers_new: "Neuer Kunde",
        customers_save: "Kunden speichern",
        customers_sub: "Erstellen und pflegen Sie Ihre Kundenliste.",
        customers_title: "Kunden",

        employees_list: "Mitarbeiterliste",
        employees_new: "Neuer Mitarbeiter",
        employees_save: "Mitarbeiter speichern",
        employees_sub: "Behalten Sie Mitarbeiter und Rollen im Überblick.",
        employees_title: "Mitarbeiter",

        menu_customers: "Kunden",
        menu_dashboard: "Zeiterfassung",
        menu_employees: "Mitarbeiter",
        menu_logs: "Protokolle",
        menu_reports: "Berichte",
        menu_settings: "Einstellungen",

        page_dashboard_sub: "Zeit für Aufgaben schnell starten und stoppen.",
        page_dashboard_title: "Zeiterfassung",

        page_logs_sub: "Verlauf der erfassten Arbeitszeit.",
        page_logs_title: "Protokolle",

        page_reports_sub: "Übersicht über erfasste Zeiten.",
        page_reports_title: "Berichte",

        page_settings_sub: "Konfiguration der Anwendung.",
        page_settings_title: "Einstellungen",

        reports_placeholder: "Das Berichtsmodul wird später hinzugefügt.",
        settings_placeholder: "Hier können Sie später erweiterte Einstellungen anpassen.",

        role_admin: "Admin",
        role_employee: "Mitarbeiter"
    },

    lt: {
        app_title: "GreenTime Pro",

        btn_start: "Pradėti",
        btn_stop: "Stabdyti",

        col_address: "Adresas",
        col_email: "El. paštas",
        col_log_duration: "Trukmė",
        col_log_time: "Laikas",
        col_name: "Vardas",
        col_phone: "Telefonas",
        col_role: "Rolė",

        customers_list: "Klientų sąrašas",
        customers_new: "Naujas klientas",
        customers_save: "Išsaugoti klientą",
        customers_sub: "Kurti ir tvarkyti klientų sąrašą.",
        customers_title: "Klientai",

        employees_list: "Darbuotojų sąrašas",
        employees_new: "Naujas darbuotojas",
        employees_save: "Išsaugoti darbuotoją",
        employees_sub: "Stebėti darbuotojus ir jų roles.",
        employees_title: "Darbuotojai",

        menu_customers: "Klientai",
        menu_dashboard: "Laiko sekimas",
        menu_employees: "Darbuotojai",
        menu_logs: "Žurnalai",
        menu_reports: "Ataskaitos",
        menu_settings: "Nustatymai",

        page_dashboard_sub: "Greitai pradėkite ir sustabdykite užduočių laiką.",
        page_dashboard_title: "Laiko sekimas",

        page_logs_sub: "Užregistruoto darbo laiko istorija.",
        page_logs_title: "Žurnalai",

        page_reports_sub: "Užregistruoto laiko apžvalga.",
        page_reports_title: "Ataskaitos",

        page_settings_sub: "Programos konfigūravimas.",
        page_settings_title: "Nustatymai",

        reports_placeholder: "Ataskaitų modulis bus pridėtas vėliau.",
        settings_placeholder: "Vėliau čia galėsite koreguoti išplėstinius nustatymus.",

        role_admin: "Administratorius",
        role_employee: "Darbuotojas"
    }
};

let currentLang = "da";

function t(key) {
    return translations[currentLang]?.[key] || translations["da"][key] || key;
}

}


/* ======================================================
   AFSNIT 02 – INITIALISERING (KORREKT VERSION)
====================================================== */

document.addEventListener("DOMContentLoaded", () => {
    initSidebarNavigation();
    initLanguage();
    initLanguageButtons();
    initThemeToggle();
    initTimer();

    installDefaultCustomers();
    installDefaultEmployees();

    initCustomerForm();
    initEmployeeForm();

    renderCustomers();
    renderEmployees();
});


/* ======================================================
   AFSNIT 03 – SIDEBAR + NAVIGATION
====================================================== */

function initSidebarNavigation() {
    const buttons = document.querySelectorAll(".menu-item");

    buttons.forEach(btn => {
        btn.addEventListener("click", () => {
            const pageId = btn.dataset.page;
            if (!pageId) return;

            showPage(pageId);

            buttons.forEach(b => b.classList.remove("active"));
            btn.classList.add("active");

            updatePageTitleFromActiveMenu();
        });
    });
}

function showPage(pageId) {
    document.querySelectorAll(".page").forEach(page => {
        page.classList.toggle("visible", page.id === pageId);
    });
}

function updatePageTitleFromActiveMenu() {
    const activeBtn = document.querySelector(".menu-item.active");
    const pageTitle = document.getElementById("pageTitle");

    if (activeBtn && pageTitle) {
        const i18nKey = activeBtn.dataset.i18n;
        pageTitle.textContent = t(i18nKey);
    }
}


/* ======================================================
   AFSNIT 04 – SPROG (I18N-System)
====================================================== */

function initLanguage() {
    const stored = localStorage.getItem("gtp_lang");
    if (stored && translations[stored]) currentLang = stored;
    applyTranslations();
}

function updateLangButtonActiveState() {
    document.querySelectorAll(".lang-btn").forEach(btn => {
        btn.classList.toggle("active", btn.dataset.lang === currentLang);
    });
}

function applyTranslations() {
    document.querySelectorAll("[data-i18n]").forEach(el => {
        const key = el.dataset.i18n;
        el.textContent = t(key);
    });

    updateLangButtonActiveState();
}

function initLanguageButtons() {
    document.querySelectorAll(".lang-btn").forEach(btn => {
        btn.addEventListener("click", () => {
            const lang = btn.dataset.lang;
            currentLang = lang;

            localStorage.setItem("gtp_lang", lang);
            applyTranslations();
            updatePageTitleFromActiveMenu();
        });
    });
}


/* ======================================================
   AFSNIT 05 – TEMA (DARK / LIGHT)
====================================================== */

function initThemeToggle() {
    const btn = document.getElementById("themeToggle");
    if (!btn) return;

    btn.addEventListener("click", () => {
        const current = document.documentElement.getAttribute("data-theme");
        const next = current === "light" ? "dark" : "light";
        document.documentElement.setAttribute("data-theme", next);
        localStorage.setItem("gtp_theme", next);
    });
}


/* ======================================================
   AFSNIT 06 – TIMER
====================================================== */

let timerInterval = null;
let timerSeconds = 0;

function initTimer() {
    const startBtn = document.getElementById("timerStartBtn");
    const stopBtn = document.getElementById("timerStopBtn");
    const display = document.getElementById("timerDisplay");

    updateTimerDisplay(display);

    startBtn?.addEventListener("click", () => startTimer(display));
    stopBtn?.addEventListener("click", () => stopTimer());
}

function startTimer(display) {
    if (timerInterval) return;

    timerInterval = setInterval(() => {
        timerSeconds++;
        updateTimerDisplay(display);
    }, 1000);
}

function stopTimer() {
    clearInterval(timerInterval);
    timerInterval = null;
}

function updateTimerDisplay(display) {
    if (!display) return;
    const h = String(Math.floor(timerSeconds / 3600)).padStart(2, "0");
    const m = String(Math.floor((timerSeconds % 3600) / 60)).padStart(2, "0");
    const s = String(timerSeconds % 60).padStart(2, "0");
    display.textContent = `${h}:${m}:${s}`;
}


/* ======================================================
   AFSNIT 06B – DEMO DATA: KUNDER
====================================================== */

function installDefaultCustomers() {
    const existing = JSON.parse(localStorage.getItem("gtp_customers"));
    if (existing && existing.length > 0) return;

    const demoCustomers = [
        { name: "Søren Olsen", phone: "21345678", email: "soren@demo.dk", address: "Sølvgade 14, København" },
        { name: "Peter Jensen", phone: "21453377", email: "peter@firma.dk", address: "Hygge Allé 3, Aarhus" },
        { name: "Lise Holm", phone: "64732467", email: "lise@holm.dk", address: "Vibevej 22, Hornbæk" },
        { name: "Camilla Sørensen", phone: "42356789", email: "camilla@camilco.dk", address: "Parkvej 5, Hillerød" },
        { name: "Anders Lund", phone: "29887766", email: "anders@lund.dk", address: "Nørregade 80, Aalborg" },
        { name: "Jenny Madsen", phone: "20228855", email: "jenny@mad.dk", address: "Havnevej 7, Esbjerg" }
    ];

    localStorage.setItem("gtp_customers", JSON.stringify(demoCustomers));
}


/* ======================================================
   AFSNIT 07 – KUNDER (FORM + LISTE) – TABELVERSION
====================================================== */

function initCustomerForm() {
    const form = document.getElementById("customerForm");
    if (!form) return;

    form.addEventListener("submit", e => {
        e.preventDefault();

        const customer = {
            name: form.customerName.value,
            phone: form.customerPhone.value,
            email: form.customerEmail.value,
            address: form.customerAddress.value
        };

        saveCustomer(customer);
        renderCustomers();
        form.reset();
    });
}

function saveCustomer(customer) {
    const customers = JSON.parse(localStorage.getItem("gtp_customers")) || [];
    customers.push(customer);
    localStorage.setItem("gtp_customers", JSON.stringify(customers));
}

function renderCustomers() {
    const tbody = document.getElementById("customerTableBody");
    if (!tbody) return;

    const customers = JSON.parse(localStorage.getItem("gtp_customers")) || [];

    tbody.innerHTML = customers
        .map(c => `
            <tr>
                <td>${c.name}</td>
                <td>${c.phone}</td>
                <td>${c.email}</td>
                <td>${c.address}</td>
            </tr>
        `)
        .join("");
}

/* ======================================================
   AFSNIT 07B – DEMO DATA: MEDARBEJDERE
====================================================== */

function installDefaultEmployees() {
    const existing = JSON.parse(localStorage.getItem("gtp_employees"));
    if (existing && existing.length > 0) return;

    const demoEmployees = [
        { name: "Lars Kristensen", email: "lars@firma.dk", role: "employee" },
        { name: "Ronny Kisbye", email: "ronny@kisbye.eu", role: "admin" },
        { name: "Emma Larsen", email: "emma@firma.dk", role: "employee" },
        { name: "Lasse Mikkelsen", email: "lasse@firma.dk", role: "employee" },
        { name: "Mia Knudsen", email: "mia@firma.dk", role: "admin" }
    ];

    localStorage.setItem("gtp_employees", JSON.stringify(demoEmployees));
}


/* ======================================================
   AFSNIT 08 – MEDARBEJDERE (FORM + LISTE) – TABELVERSION
====================================================== */

function initEmployeeForm() {
    const form = document.getElementById("employeeForm");
    if (!form) return;

    form.addEventListener("submit", e => {
        e.preventDefault();

        const employee = {
            name: form.employeeName.value,
            email: form.employeeEmail.value,
            role: form.employeeRole.value
        };

        saveEmployee(employee);
        renderEmployees();
        form.reset();
    });
}

function saveEmployee(employee) {
    const employees = JSON.parse(localStorage.getItem("gtp_employees")) || [];
    employees.push(employee);
    localStorage.setItem("gtp_employees", JSON.stringify(employees));
}

function renderEmployees() {
    const tbody = document.getElementById("employeeTableBody");
    if (!tbody) return;

    const employees = JSON.parse(localStorage.getItem("gtp_employees")) || [];

    tbody.innerHTML = employees
        .map(e => `
            <tr>
                <td>${e.name}</td>
                <td>${e.email}</td>
                <td>${e.role}</td>
            </tr>
        `)
        .join("");
}
